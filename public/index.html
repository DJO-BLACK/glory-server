<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>GLORY ‚Äì Accueil</title>
  <link rel="stylesheet" href="style.css"/>
  <link rel="manifest" href="manifest.json"/>
  <meta name="theme-color" content="#D4AF37"/>
  <style>
    .hero{position:relative;min-height:100vh;display:flex;align-items:center;justify-content:center;text-align:center;overflow:hidden;}
    .hero-bg{position:absolute;inset:0;background:radial-gradient(ellipse at 50% 30%,rgba(212,175,55,.15) 0%,transparent 60%),linear-gradient(180deg,#0a0800,#1a1200 50%,#0a0800);}
    .hero-img{position:absolute;inset:0;background-image:url('https://images.unsplash.com/photo-1519491050282-cf00c82424b3?w=1600&q=80');background-size:cover;background-position:center;opacity:.15;}
    .hero-content{position:relative;z-index:2;max-width:900px;padding:2rem;animation:heroIn 1.2s ease forwards;}
    @keyframes heroIn{from{opacity:0;transform:translateY(40px);}to{opacity:1;transform:translateY(0);}}
    .hero-cross{font-size:3rem;color:var(--gold);margin-bottom:1rem;animation:glow 3s ease-in-out infinite;}
    @keyframes glow{0%,100%{text-shadow:0 0 20px rgba(212,175,55,.5);}50%{text-shadow:0 0 60px rgba(212,175,55,1);}}
    .hero-content h1{font-family:'Cinzel Decorative',cursive;font-size:clamp(3rem,10vw,7rem);color:var(--gold);letter-spacing:8px;}
    .hero-content h2{font-family:'Playfair Display',serif;font-style:italic;font-size:clamp(1rem,2.5vw,1.4rem);color:var(--white);margin-top:.8rem;letter-spacing:3px;font-weight:300;}
    .hero-divider{width:80px;height:2px;background:linear-gradient(90deg,transparent,var(--gold),transparent);margin:1.5rem auto;}
    .hero-desc{color:var(--text-muted);margin:0 auto 2rem;max-width:580px;line-height:1.9;}
    .btn-cta{display:inline-block;background:linear-gradient(135deg,var(--gold-dark),var(--gold),var(--gold-light));color:var(--bg-dark);font-weight:700;font-size:.9rem;letter-spacing:3px;text-transform:uppercase;padding:1rem 2.5rem;border:none;cursor:pointer;transition:all .3s;clip-path:polygon(8px 0%,100% 0%,calc(100% - 8px) 100%,0% 100%);}
    .btn-cta:hover{transform:translateY(-3px);box-shadow:0 10px 30px rgba(212,175,55,.5);}
    /* ADMIN FORM */
    .admin-form-box{background:rgba(212,175,55,.04);border:1px solid rgba(212,175,55,.2);border-radius:8px;padding:2rem;margin-bottom:2rem;display:none;}
    .admin-form-box h3{font-family:'Cinzel Decorative',cursive;color:var(--gold);font-size:1rem;margin-bottom:1.5rem;}
    .post-type-tabs{display:flex;gap:.5rem;margin-bottom:1.2rem;flex-wrap:wrap;}
    .post-type-tab{padding:.5rem 1.1rem;border-radius:4px;cursor:pointer;font-size:.8rem;font-weight:700;border:1px solid rgba(212,175,55,.3);color:var(--text-muted);background:none;transition:all .3s;}
    .post-type-tab.active{background:var(--gold);color:var(--bg-dark);border-color:var(--gold);}
    .upload-area{border:2px dashed rgba(212,175,55,.3);border-radius:6px;padding:2rem;text-align:center;cursor:pointer;transition:all .3s;}
    .upload-area:hover{border-color:var(--gold);background:rgba(212,175,55,.04);}
    .upload-icon{font-size:2rem;margin-bottom:.5rem;}
    .upload-area p{color:var(--text-muted);font-size:.85rem;}
    .media-preview-img{max-width:100%;max-height:200px;border-radius:6px;margin-top:.5rem;display:none;border:1px solid rgba(212,175,55,.2);}
    .media-preview-vid{max-width:100%;max-height:200px;border-radius:6px;margin-top:.5rem;display:none;}
    /* FEED */
    .feed-wrap{max-width:680px;margin:0 auto;display:flex;flex-direction:column;gap:1.5rem;}
    .post-card{background:rgba(255,255,255,.03);border:1px solid rgba(212,175,55,.15);border-radius:10px;overflow:hidden;transition:border-color .3s;}
    .post-card:hover{border-color:rgba(212,175,55,.35);}
    .post-header{display:flex;align-items:center;gap:.8rem;padding:1rem 1.2rem .7rem;}
    .post-avatar{width:42px;height:42px;border-radius:50%;background:linear-gradient(135deg,#ff9800,#ffcc02);display:flex;align-items:center;justify-content:center;font-size:.9rem;font-weight:700;color:var(--bg-dark);flex-shrink:0;overflow:hidden;}
    .post-avatar img{width:100%;height:100%;object-fit:cover;border-radius:50%;}
    .post-author{font-size:.88rem;color:var(--white);font-weight:700;}
    .post-date{font-size:.7rem;color:rgba(184,168,122,.5);}
    .post-type-label{margin-left:auto;font-size:.62rem;letter-spacing:1px;text-transform:uppercase;color:var(--gold);background:rgba(212,175,55,.1);border:1px solid rgba(212,175,55,.2);padding:.2rem .6rem;border-radius:3px;white-space:nowrap;}
    .post-media{background:#000;display:flex;align-items:center;justify-content:center;overflow:hidden;max-height:480px;}
    .post-media img{width:100%;height:auto;max-height:480px;object-fit:contain;display:block;background:#000;}
    .post-media video{width:100%;max-height:480px;display:block;background:#000;}
    .post-text{padding:1rem 1.2rem;color:var(--white);font-size:.92rem;line-height:1.75;}
    .post-text.only-text{padding:1.4rem;}
    .post-actions{display:flex;gap:1rem;padding:.7rem 1.2rem;border-top:1px solid rgba(255,255,255,.05);align-items:center;}
    .action-btn{display:flex;align-items:center;gap:.4rem;background:none;border:none;color:var(--text-muted);font-size:.85rem;cursor:pointer;padding:.3rem .7rem;border-radius:6px;transition:all .3s;}
    .action-btn:hover{background:rgba(255,255,255,.05);color:var(--white);}
    .action-btn.liked{color:#e53e3e;}
    .delete-post-btn{margin-left:auto;background:none;border:none;color:rgba(229,62,62,.4);cursor:pointer;font-size:.85rem;transition:color .2s;display:none;}
    .delete-post-btn.visible{display:block;}
    .delete-post-btn:hover{color:#e53e3e;}
    .comments-section{border-top:1px solid rgba(255,255,255,.05);padding:.8rem 1.2rem;display:none;}
    .comments-section.open{display:block;}
    .comment-item{display:flex;gap:.6rem;margin-bottom:.7rem;align-items:flex-start;}
    .comment-av{width:28px;height:28px;border-radius:50%;background:linear-gradient(135deg,var(--gold-dark),var(--gold));display:flex;align-items:center;justify-content:center;font-size:.65rem;font-weight:700;color:var(--bg-dark);flex-shrink:0;}
    .comment-av.adm{background:linear-gradient(135deg,#ff9800,#ffcc02);}
    .comment-bubble{background:rgba(255,255,255,.04);border-radius:6px;padding:.5rem .8rem;flex:1;}
    .comment-name{font-size:.7rem;color:var(--gold);font-weight:700;margin-bottom:.15rem;}
    .comment-name.adm{color:#ff9800;}
    .comment-text{font-size:.83rem;color:var(--white);line-height:1.5;}
    .comment-input-row{display:flex;gap:.5rem;margin-top:.7rem;}
    .comment-input{flex:1;background:rgba(0,0,0,.4);border:1px solid rgba(212,175,55,.2);color:var(--white);padding:.5rem .8rem;border-radius:4px;font-size:.83rem;font-family:'Lato',sans-serif;outline:none;}
    .comment-input:focus{border-color:var(--gold);}
    .comment-send{background:var(--gold);color:var(--bg-dark);border:none;padding:.5rem 1rem;border-radius:4px;font-weight:700;font-size:.78rem;cursor:pointer;}
    .comment-send:hover{background:var(--gold-light);}
    .login-interact{font-size:.78rem;color:var(--text-muted);text-align:center;padding:.5rem;}
    .login-interact span{color:var(--gold);cursor:pointer;}
    .empty-feed{text-align:center;padding:4rem 2rem;color:var(--text-muted);}
  </style>
</head>
<body>
<div class="page-content" style="padding-top:0;">
  <div class="hero">
    <div class="hero-bg"></div><div class="hero-img"></div>
    <div class="hero-content">
      <div class="hero-cross">‚úû</div>
      <h1>GLORY</h1>
      <h2 data-i18n="hero_sub">R√©unis dans Sa Pr√©sence</h2>
      <div class="hero-divider"></div>
      <p class="hero-desc" data-i18n="hero_desc">Une communaut√© mondiale pour adorer et parler du seul vrai DIEU.</p>
      <button class="btn-cta" onclick="openModal('signup')" data-i18n="hero_cta">Rejoindre la Communaut√©</button>
    </div>
  </div>

  <div class="section-wrap">
    <div class="section-header">
      <span class="section-tag" data-i18n="feed_tag">‚ú¶ Publications ‚ú¶</span>
      <h2 class="section-title" data-i18n="feed_title">La Parole du Jour</h2>
      <div class="section-line"></div>
    </div>

    <!-- Admin post form -->
    <div class="admin-form-box" id="adminPostForm">
      <h3>‚ûï Cr√©er un Post</h3>
      <div class="post-type-tabs">
        <button class="post-type-tab active" onclick="selType('texte',this)">üìù Texte</button>
        <button class="post-type-tab" onclick="selType('photo',this)">üì∑ Photo</button>
        <button class="post-type-tab" onclick="selType('video',this)">üé• Vid√©o</button>
      </div>
      <div class="form-group">
        <label>Cat√©gorie</label>
        <select id="pType"><option>Message</option><option>Pri√®re</option><option>√âtude Biblique</option><option>Annonce</option><option>T√©moignage</option></select>
      </div>
      <div class="form-group"><label>Titre</label><input type="text" id="pTitle" placeholder="Titre du post..."/></div>
      <div class="form-group"><label>Message</label><textarea id="pContent" rows="4" placeholder="√âcris ton message..."></textarea></div>
      <div id="mediaSection" style="display:none;">
        <div class="form-group">
          <label id="mediaLabel">M√©dia</label>
          <div class="upload-area" onclick="document.getElementById('fileInput').click()">
            <div class="upload-icon" id="uploadIcon">üì∑</div>
            <p id="uploadText">Clique pour choisir un fichier</p>
          </div>
          <input type="file" id="fileInput" style="display:none" onchange="previewFile(this)"/>
          <img id="mediaPreviewImg" class="media-preview-img"/>
          <video id="mediaPreviewVid" class="media-preview-vid" controls></video>
        </div>
      </div>
      <button class="btn-submit" onclick="publishPost()" data-i18n="publish">Publier</button>
    </div>

    <div class="feed-wrap" id="feedGrid"></div>
    <div class="empty-feed" id="emptyFeed">
      <div style="font-size:3rem;margin-bottom:1rem;">‚úû</div>
      <p>Aucune publication pour le moment.</p>
    </div>
  </div>
</div>

<script src="components.js"></script>
<script src="auth.js"></script>
<script src="i18n.js"></script>
<script src="notifications.js"></script>
<script>
let curType='texte', mediaDataUrl=null, mediaFileType=null;

function selType(t,btn){
  curType=t;
  document.querySelectorAll('.post-type-tab').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  const ms=document.getElementById('mediaSection');
  ms.style.display=t==='texte'?'none':'block';
  document.getElementById('uploadIcon').textContent=t==='photo'?'üì∑':'üé•';
  document.getElementById('uploadText').textContent=t==='photo'?'Clique pour choisir une photo':'Clique pour choisir une vid√©o';
  document.getElementById('fileInput').accept=t==='photo'?'image/*':'video/*';
  document.getElementById('mediaPreviewImg').style.display='none';
  document.getElementById('mediaPreviewVid').style.display='none';
  mediaDataUrl=null;
}

function previewFile(input){
  const f=input.files[0]; if(!f)return;
  const r=new FileReader();
  r.onload=e=>{
    mediaDataUrl=e.target.result;
    mediaFileType=f.type.startsWith('video')?'video':'image';
    if(mediaFileType==='image'){document.getElementById('mediaPreviewImg').src=mediaDataUrl;document.getElementById('mediaPreviewImg').style.display='block';document.getElementById('mediaPreviewVid').style.display='none';}
    else{document.getElementById('mediaPreviewVid').src=mediaDataUrl;document.getElementById('mediaPreviewVid').style.display='block';document.getElementById('mediaPreviewImg').style.display='none';}
  };
  r.readAsDataURL(f);
}

function publishPost(){
  const type=document.getElementById('pType').value;
  const title=document.getElementById('pTitle').value.trim();
  const content=document.getElementById('pContent').value.trim();
  if(!title&&!content){toast('Ajoute un titre ou du contenu.');return;}
  if(curType!=='texte'&&!mediaDataUrl){toast('S√©lectionne un fichier.');return;}
  const posts=getPosts();
  posts.unshift({id:Date.now(),type,postType:curType,title,content,media:mediaDataUrl,mediaType:mediaFileType,date:new Date().toLocaleDateString('fr'),likes:[],comments:[]});
  savePosts(posts);
  document.getElementById('pTitle').value='';
  document.getElementById('pContent').value='';
  document.getElementById('mediaPreviewImg').style.display='none';
  document.getElementById('mediaPreviewVid').style.display='none';
  mediaDataUrl=null;
  createNotif('post', title||'Nouvelle publication', content?content.substring(0,60)+'...':'Voir la publication', 'index.html');
  renderFeed();
  toast('‚úÖ Post publi√© !');
}

function toggleLike(id){
  const user=getSession(); if(!user){openModal('login');return;}
  const posts=getPosts(),post=posts.find(p=>p.id===id); if(!post)return;
  if(!post.likes)post.likes=[];
  const i=post.likes.indexOf(user.name);
  if(i===-1){post.likes.push(user.name);const lk='glory_likes_'+user.email;localStorage.setItem(lk,(parseInt(localStorage.getItem(lk)||'0')+1).toString());}
  else post.likes.splice(i,1);
  savePosts(posts);renderFeed();
}

function toggleComments(id){document.getElementById('cmt-'+id)?.classList.toggle('open');}

function addComment(id){
  const user=getSession(); if(!user){openModal('login');return;}
  const input=document.getElementById('cinput-'+id);
  const text=input.value.trim(); if(!text)return;
  const posts=getPosts(),post=posts.find(p=>p.id===id); if(!post)return;
  if(!post.comments)post.comments=[];
  post.comments.push({name:user.name,role:user.role,text,time:new Date().toLocaleTimeString('fr',{hour:'2-digit',minute:'2-digit'})});
  savePosts(posts);input.value='';renderFeed();
  setTimeout(()=>document.getElementById('cmt-'+id)?.classList.add('open'),50);
}

function deletePost(id){
  if(!confirm('Supprimer ce post ?'))return;
  savePosts(getPosts().filter(p=>p.id!==id));renderFeed();toast('Post supprim√©.');
}

function renderFeed(){
  const posts=getPosts(),grid=document.getElementById('feedGrid'),empty=document.getElementById('emptyFeed');
  const user=getSession(),isAdmin=user&&user.role==='admin';
  grid.innerHTML='';
  if(posts.length===0){empty.style.display='block';return;}
  empty.style.display='none';
  const savedAvatar=isAdmin?localStorage.getItem('glory_avatar_'+user?.email):null;

  posts.forEach(p=>{
    const liked=(p.likes||[]).includes(user?.name);
    const lc=(p.likes||[]).length,cc=(p.comments||[]).length;
    let mediaHtml='';
    if(p.media){
      mediaHtml=p.mediaType==='video'
        ?`<div class="post-media"><video src="${p.media}" controls></video></div>`
        :`<div class="post-media"><img src="${p.media}" alt="${p.title}" loading="lazy"/></div>`;
    }
    const textHtml=(p.title||p.content)?`<div class="post-text${!p.media?' only-text':''}">${p.title?`<strong style="color:var(--gold);font-family:'Playfair Display',serif;font-size:1.05rem;display:block;margin-bottom:.4rem;">${p.title}</strong>`:''} ${p.content||''}</div>`:'';
    const cmtsHtml=`<div class="comments-section" id="cmt-${p.id}">
      ${(p.comments||[]).map(c=>{const ini=c.name.split(' ').map(w=>w[0]).join('').substring(0,2).toUpperCase();return`<div class="comment-item"><div class="comment-av ${c.role==='admin'?'adm':''}">${ini}</div><div class="comment-bubble"><div class="comment-name ${c.role==='admin'?'adm':''}">${c.role==='admin'?'‚ú¶ ':''}${c.name}</div><div class="comment-text">${c.text}</div></div></div>`;}).join('')}
      ${user?`<div class="comment-input-row"><input class="comment-input" type="text" id="cinput-${p.id}" placeholder="Ajoute un commentaire..." onkeydown="if(event.key==='Enter')addComment(${p.id})"/><button class="comment-send" onclick="addComment(${p.id})">Envoyer</button></div>`:`<p class="login-interact"><span onclick="openModal('login')">Connecte-toi</span> pour commenter</p>`}
    </div>`;
    const avatarHtml=savedAvatar?`<img src="${savedAvatar}" alt=""/>`:'AG';
    const card=document.createElement('div');
    card.className='post-card';
    card.innerHTML=`<div class="post-header"><div class="post-avatar">${avatarHtml}</div><div><div class="post-author">Admin Glory</div><div class="post-date">${p.date}</div></div><span class="post-type-label">‚ú¶ ${p.type}</span></div>
    ${mediaHtml}${textHtml}
    <div class="post-actions">
      <button class="action-btn${liked?' liked':''}" onclick="toggleLike(${p.id})">${liked?'‚ù§Ô∏è':'ü§ç'} ${lc>0?lc:''} J'aime</button>
      <button class="action-btn" onclick="toggleComments(${p.id})">üí¨ ${cc>0?cc:''} Commentaires</button>
      <button class="delete-post-btn${isAdmin?' visible':''}" onclick="deletePost(${p.id})" title="Supprimer">üóë</button>
    </div>${cmtsHtml}`;
    grid.appendChild(card);
  });
}

window.addEventListener('DOMContentLoaded',()=>{
  renderFeed();
  const user=getSession();
  if(user&&user.role==='admin')document.getElementById('adminPostForm').style.display='block';
});
</script>
</body>
</html>
